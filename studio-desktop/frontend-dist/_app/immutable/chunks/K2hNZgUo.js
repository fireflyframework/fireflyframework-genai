import{W as ne,e as Je,at as Fe,h as S,g as W,au as Be,d as ie,y as V,r as ct,_ as ft,s as Ie,i as R,j as L,av as dt,aw as ut,ax as je,R as C,ay as M,X as Z,az as ht,Z as pt,ag as vt,aA as Ge,aB as Ee,aC as gt,aD as mt,a0 as _t,ab as Le,aE as yt,T as qe,V as Ue,aF as _e,q as oe,aG as bt,aH as St,aI as $t,U as le,aJ as wt,aK as Tt,E as At,aL as se,aM as kt,aN as Nt,aO as Et,aP as Ot,a9 as Pt,a3 as Oe,aQ as Ye,k as Pe,aR as Ct,aS as Ke,aT as pe,aU as Qe,aV as Mt,aW as It,aX as ee,aY as jt,L as Lt,K as Rt,aZ as xt,a_ as Dt,a$ as Ht,b0 as zt,b1 as Wt,b2 as Vt,b3 as Jt,b4 as Ft,b5 as Bt,b6 as Gt,ar as qt,u as ce,l as Ce,p as Ut,a as x,b as Yt,b7 as Kt,z as H,F as Qt,I as Xt,G as Zt,c as F,f as B,Q as ea,b8 as ta,b9 as aa,w as I,a2 as J}from"./BNectIeB.js";import"./DsnmJJEf.js";import{i as sa}from"./FsCUQR17.js";import{B as na,l as D,p as z,s as te}from"./BB2KRr3j.js";function ra(e,t){return t}function ia(e,t,a){for(var s=[],n=t.length,i,r=t.length,o=0;o<n;o++){let v=t[o];Ue(v,()=>{if(i){if(i.pending.delete(v),i.done.add(v),i.pending.size===0){var u=e.outrogroups;Te(Ee(i.done)),u.delete(i),u.size===0&&(e.outrogroups=null)}}else r-=1},!1)}if(r===0){var f=s.length===0&&a!==null;if(f){var c=a,l=c.parentNode;$t(l),l.append(c),e.items.clear()}Te(t,!f)}else i={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(i)}function Te(e,t=!0){for(var a=0;a<e.length;a++)le(e[a],t)}var Re;function oa(e,t,a,s,n,i=null){var r=e,o=new Map,f=(t&Fe)!==0;if(f){var c=e;r=S?W(Be(c)):c.appendChild(ne())}S&&ie();var l=null,v=vt(()=>{var p=a();return Ge(p)?p:p==null?[]:Ee(p)}),u,m=!0;function $(){d.fallback=l,la(d,u,r,t,s),l!==null&&(u.length===0?(l.f&M)===0?qe(l):(l.f^=M,Q(l,null,r)):Ue(l,()=>{l=null}))}var T=Je(()=>{u=V(v);var p=u.length;let N=!1;if(S){var E=ct(r)===ft;E!==(p===0)&&(r=Ie(),W(r),R(!1),N=!0)}for(var b=new Set,O=C,_=pt(),g=0;g<p;g+=1){S&&L.nodeType===dt&&L.data===ut&&(r=L,N=!0,R(!1));var w=u[g],k=s(w,g),y=m?null:o.get(k);y?(y.v&&je(y.v,w),y.i&&je(y.i,g),_&&O.unskip_effect(y.e)):(y=ca(o,m?r:Re??=ne(),w,k,g,n,t,a),m||(y.e.f|=M),o.set(k,y)),b.add(k)}if(p===0&&i&&!l&&(m?l=Z(()=>i(r)):(l=Z(()=>i(Re??=ne())),l.f|=M)),p>b.size&&ht(),S&&p>0&&W(Ie()),!m)if(_){for(const[ge,me]of o)b.has(ge)||O.skip_effect(me.e);O.oncommit($),O.ondiscard(()=>{})}else $();N&&R(!0),V(v)}),d={effect:T,items:o,outrogroups:null,fallback:l};m=!1,S&&(r=L)}function U(e){for(;e!==null&&(e.f&bt)===0;)e=e.next;return e}function la(e,t,a,s,n){var i=(s&St)!==0,r=t.length,o=e.items,f=U(e.effect.first),c,l=null,v,u=[],m=[],$,T,d,p;if(i)for(p=0;p<r;p+=1)$=t[p],T=n($,p),d=o.get(T).e,(d.f&M)===0&&(d.nodes?.a?.measure(),(v??=new Set).add(d));for(p=0;p<r;p+=1){if($=t[p],T=n($,p),d=o.get(T).e,e.outrogroups!==null)for(const y of e.outrogroups)y.pending.delete(d),y.done.delete(d);if((d.f&M)!==0)if(d.f^=M,d===f)Q(d,null,a);else{var N=l?l.next:f;d===e.effect.last&&(e.effect.last=d.prev),d.prev&&(d.prev.next=d.next),d.next&&(d.next.prev=d.prev),j(e,l,d),j(e,d,N),Q(d,N,a),l=d,u=[],m=[],f=U(l.next);continue}if((d.f&_e)!==0&&(qe(d),i&&(d.nodes?.a?.unfix(),(v??=new Set).delete(d))),d!==f){if(c!==void 0&&c.has(d)){if(u.length<m.length){var E=m[0],b;l=E.prev;var O=u[0],_=u[u.length-1];for(b=0;b<u.length;b+=1)Q(u[b],E,a);for(b=0;b<m.length;b+=1)c.delete(m[b]);j(e,O.prev,_.next),j(e,l,O),j(e,_,E),f=E,l=_,p-=1,u=[],m=[]}else c.delete(d),Q(d,f,a),j(e,d.prev,d.next),j(e,d,l===null?e.effect.first:l.next),j(e,l,d),l=d;continue}for(u=[],m=[];f!==null&&f!==d;)(c??=new Set).add(f),m.push(f),f=U(f.next);if(f===null)continue}(d.f&M)===0&&u.push(d),l=d,f=U(d.next)}if(e.outrogroups!==null){for(const y of e.outrogroups)y.pending.size===0&&(Te(Ee(y.done)),e.outrogroups?.delete(y));e.outrogroups.size===0&&(e.outrogroups=null)}if(f!==null||c!==void 0){var g=[];if(c!==void 0)for(d of c)(d.f&_e)===0&&g.push(d);for(;f!==null;)(f.f&_e)===0&&f!==e.fallback&&g.push(f),f=U(f.next);var w=g.length;if(w>0){var k=(s&Fe)!==0&&r===0?a:null;if(i){for(p=0;p<w;p+=1)g[p].nodes?.a?.measure();for(p=0;p<w;p+=1)g[p].nodes?.a?.fix()}ia(e,g,k)}}i&&oe(()=>{if(v!==void 0)for(d of v)d.nodes?.a?.apply()})}function ca(e,t,a,s,n,i,r,o){var f=(r&gt)!==0?(r&mt)===0?_t(a,!1,!1):Le(a):null,c=(r&yt)!==0?Le(n):null;return{v:f,i:c,e:Z(()=>(i(t,f??a,c??n,o),()=>{e.delete(s)}))}}function Q(e,t,a){if(e.nodes)for(var s=e.nodes.start,n=e.nodes.end,i=t&&(t.f&M)===0?t.nodes.start:a;s!==null;){var r=wt(s);if(i.before(s),s===n)return;s=r}}function j(e,t,a){t===null?e.effect.first=a:t.next=a,a===null?e.effect.last=t:a.prev=t}function G(e,t,a,s,n){S&&ie();var i=t.$$slots?.[a],r=!1;i===!0&&(i=t.children,r=!0),i===void 0||i(e,r?()=>s:s)}function fa(e,t,a,s,n,i){let r=S;S&&ie();var o=null;S&&L.nodeType===Tt&&(o=L,ie());var f=S?L:e,c=new na(f,!1);Je(()=>{const l=t()||null;var v=Nt;if(l===null){c.ensure(null,null),se(!0);return}return c.ensure(l,u=>{if(l){if(o=S?o:kt(l,v),Et(o,o),s){S&&Ot(l)&&o.append(document.createComment(""));var m=S?Be(o):o.appendChild(ne());S&&(m===null?R(!1):W(m)),s(o,m)}Pt.nodes.end=o,u.before(o)}S&&W(u)}),se(!0),()=>{l&&se(!1)}},At),Oe(()=>{se(!0)}),r&&(R(!0),W(f))}function da(e,t){var a=void 0,s;Ye(()=>{a!==(a=t())&&(s&&(le(s),s=null),a&&(s=Z(()=>{Pe(()=>a(e))})))})}function Xe(e){var t,a,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var n=e.length;for(t=0;t<n;t++)e[t]&&(a=Xe(e[t]))&&(s&&(s+=" "),s+=a)}else for(a in e)e[a]&&(s&&(s+=" "),s+=a);return s}function ua(){for(var e,t,a=0,s="",n=arguments.length;a<n;a++)(e=arguments[a])&&(t=Xe(e))&&(s&&(s+=" "),s+=t);return s}function ha(e){return typeof e=="object"?ua(e):e??""}const xe=[...` 	
\r\f \v\uFEFF`];function pa(e,t,a){var s=e==null?"":""+e;if(t&&(s=s?s+" "+t:t),a){for(var n of Object.keys(a))if(a[n])s=s?s+" "+n:n;else if(s.length)for(var i=n.length,r=0;(r=s.indexOf(n,r))>=0;){var o=r+i;(r===0||xe.includes(s[r-1]))&&(o===s.length||xe.includes(s[o]))?s=(r===0?"":s.substring(0,r))+s.substring(o+1):r=o}}return s===""?null:s}function De(e,t=!1){var a=t?" !important;":";",s="";for(var n of Object.keys(e)){var i=e[n];i!=null&&i!==""&&(s+=" "+n+": "+i+a)}return s}function ye(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function va(e,t){if(t){var a="",s,n;if(Array.isArray(t)?(s=t[0],n=t[1]):s=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,r=0,o=!1,f=[];s&&f.push(...Object.keys(s).map(ye)),n&&f.push(...Object.keys(n).map(ye));var c=0,l=-1;const T=e.length;for(var v=0;v<T;v++){var u=e[v];if(o?u==="/"&&e[v-1]==="*"&&(o=!1):i?i===u&&(i=!1):u==="/"&&e[v+1]==="*"?o=!0:u==='"'||u==="'"?i=u:u==="("?r++:u===")"&&r--,!o&&i===!1&&r===0){if(u===":"&&l===-1)l=v;else if(u===";"||v===T-1){if(l!==-1){var m=ye(e.substring(c,l).trim());if(!f.includes(m)){u!==";"&&v++;var $=e.substring(c,v).trim();a+=" "+$+";"}}c=v+1,l=-1}}}}return s&&(a+=De(s)),n&&(a+=De(n,!0)),a=a.trim(),a===""?null:a}return e==null?null:String(e)}function ga(e,t,a,s,n,i){var r=e.__className;if(S||r!==a||r===void 0){var o=pa(a,s,i);(!S||o!==e.getAttribute("class"))&&(o==null?e.removeAttribute("class"):t?e.className=o:e.setAttribute("class",o)),e.__className=a}else if(i&&n!==i)for(var f in i){var c=!!i[f];(n==null||c!==!!n[f])&&e.classList.toggle(f,c)}return i}function be(e,t={},a,s){for(var n in a){var i=a[n];t[n]!==i&&(a[n]==null?e.style.removeProperty(n):e.style.setProperty(n,i,s))}}function ma(e,t,a,s){var n=e.__style;if(S||n!==t){var i=va(t,s);(!S||i!==e.getAttribute("style"))&&(i==null?e.removeAttribute("style"):e.style.cssText=i),e.__style=t}else s&&(Array.isArray(s)?(be(e,a?.[0],s[0]),be(e,a?.[1],s[1],"important")):be(e,a,s));return s}function fe(e,t,a=!1){if(e.multiple){if(t==null)return;if(!Ge(t))return Ct();for(var s of e.options)s.selected=t.includes(X(s));return}for(s of e.options){var n=X(s);if(Ke(n,t)){s.selected=!0;return}}(!a||t!==void 0)&&(e.selectedIndex=-1)}function Ze(e){var t=new MutationObserver(()=>{fe(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Oe(()=>{t.disconnect()})}function za(e,t,a=t){var s=new WeakSet,n=!0;pe(e,"change",i=>{var r=i?"[selected]":":checked",o;if(e.multiple)o=[].map.call(e.querySelectorAll(r),X);else{var f=e.querySelector(r)??e.querySelector("option:not([disabled])");o=f&&X(f)}a(o),C!==null&&s.add(C)}),Pe(()=>{var i=t();if(e===document.activeElement){var r=Qe??C;if(s.has(r))return}if(fe(e,i,n),n&&i===void 0){var o=e.querySelector(":checked");o!==null&&(i=X(o),a(i))}e.__value=i,n=!1}),Ze(e)}function X(e){return"__value"in e?e.__value:e.value}const Y=Symbol("class"),K=Symbol("style"),et=Symbol("is custom element"),tt=Symbol("is html"),_a=ee?"link":"LINK",ya=ee?"input":"INPUT",ba=ee?"option":"OPTION",Sa=ee?"select":"SELECT",$a=ee?"progress":"PROGRESS";function wa(e){if(S){var t=!1,a=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var s=e.value;de(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var n=e.checked;de(e,"checked",null),e.checked=n}}};e.__on_r=a,oe(a),Wt()}}function Wa(e,t){var a=Me(e);a.value===(a.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!==$a)||(e.value=t??"")}function Ta(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function de(e,t,a,s){var n=Me(e);S&&(n[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName===_a)||n[t]!==(n[t]=a)&&(t==="loading"&&(e[Ft]=a),a==null?e.removeAttribute(t):typeof a!="string"&&at(e).includes(t)?e[t]=a:e.setAttribute(t,a))}function Aa(e,t,a,s,n=!1,i=!1){if(S&&n&&e.nodeName===ya){var r=e,o=r.type==="checkbox"?"defaultChecked":"defaultValue";o in a||wa(r)}var f=Me(e),c=f[et],l=!f[tt];let v=S&&c;v&&R(!1);var u=t||{},m=e.nodeName===ba;for(var $ in t)$ in a||(a[$]=null);a.class?a.class=ha(a.class):(s||a[Y])&&(a.class=null),a[K]&&(a.style??=null);var T=at(e);for(const _ in a){let g=a[_];if(m&&_==="value"&&g==null){e.value=e.__value="",u[_]=g;continue}if(_==="class"){var d=e.namespaceURI==="http://www.w3.org/1999/xhtml";ga(e,d,g,s,t?.[Y],a[Y]),u[_]=g,u[Y]=a[Y];continue}if(_==="style"){ma(e,g,t?.[K],a[K]),u[_]=g,u[K]=a[K];continue}var p=u[_];if(!(g===p&&!(g===void 0&&e.hasAttribute(_)))){u[_]=g;var N=_[0]+_[1];if(N!=="$$")if(N==="on"){const w={},k="$$"+_;let y=_.slice(2);var E=Bt(y);if(jt(y)&&(y=y.slice(0,-7),w.capture=!0),!E&&p){if(g!=null)continue;e.removeEventListener(y,u[k],w),u[k]=null}if(E)Lt(y,e,g),Rt([y]);else if(g!=null){let ge=function(me){u[_].call(this,me)};u[k]=xt(y,e,ge,w)}}else if(_==="style")de(e,_,g);else if(_==="autofocus")Dt(e,!!g);else if(!c&&(_==="__value"||_==="value"&&g!=null))e.value=e.__value=g;else if(_==="selected"&&m)Ta(e,g);else{var b=_;l||(b=Ht(b));var O=b==="defaultValue"||b==="defaultChecked";if(g==null&&!c&&!O)if(f[_]=null,b==="value"||b==="checked"){let w=e;const k=t===void 0;if(b==="value"){let y=w.defaultValue;w.removeAttribute(b),w.defaultValue=y,w.value=w.__value=k?y:null}else{let y=w.defaultChecked;w.removeAttribute(b),w.defaultChecked=y,w.checked=k?y:!1}}else e.removeAttribute(_);else O||T.includes(b)&&(c||typeof g!="string")?(e[b]=g,b in f&&(f[b]=zt)):typeof g!="function"&&de(e,b,g)}}}return v&&R(!0),u}function He(e,t,a=[],s=[],n=[],i,r=!1,o=!1){Mt(n,a,s,f=>{var c=void 0,l={},v=e.nodeName===Sa,u=!1;if(Ye(()=>{var $=t(...f.map(V)),T=Aa(e,c,$,i,r,o);u&&v&&"value"in $&&fe(e,$.value);for(let p of Object.getOwnPropertySymbols(l))$[p]||le(l[p]);for(let p of Object.getOwnPropertySymbols($)){var d=$[p];p.description===It&&(!c||d!==c[p])&&(l[p]&&le(l[p]),l[p]=Z(()=>da(e,()=>d))),T[p]=d}c=T}),v){var m=e;Pe(()=>{fe(m,c.value,!0),Ze(m)})}u=!0})}function Me(e){return e.__attributes??={[et]:e.nodeName.includes("-"),[tt]:e.namespaceURI===Vt}}var ze=new Map;function at(e){var t=e.getAttribute("is")||e.nodeName,a=ze.get(t);if(a)return a;ze.set(t,a=[]);for(var s,n=e,i=Element.prototype;i!==n;){s=Gt(n);for(var r in s)s[r].set&&a.push(r);n=Jt(n)}return a}function Va(e,t,a=t){var s=new WeakSet;pe(e,"input",async n=>{var i=n?e.defaultValue:e.value;if(i=$e(e)?we(i):i,a(i),C!==null&&s.add(C),await qt(),i!==(i=t())){var r=e.selectionStart,o=e.selectionEnd,f=e.value.length;if(e.value=i??"",o!==null){var c=e.value.length;r===o&&o===f&&c>f?(e.selectionStart=c,e.selectionEnd=c):(e.selectionStart=r,e.selectionEnd=Math.min(o,c))}}}),(S&&e.defaultValue!==e.value||ce(t)==null&&e.value)&&(a($e(e)?we(e.value):e.value),C!==null&&s.add(C)),Ce(()=>{var n=t();if(e===document.activeElement){var i=Qe??C;if(s.has(i))return}$e(e)&&n===we(e.value)||e.type==="date"&&!n&&!e.value||n!==e.value&&(e.value=n??"")})}const Se=new Set;function Ja(e,t,a,s,n=s){var i=a.getAttribute("type")==="checkbox",r=e;let o=!1;if(t!==null)for(var f of t)r=r[f]??=[];r.push(a),pe(a,"change",()=>{var c=a.__value;i&&(c=We(r,c,a.checked)),n(c)},()=>n(i?[]:null)),Ce(()=>{var c=s();if(S&&a.defaultChecked!==a.checked){o=!0;return}i?(c=c||[],a.checked=c.includes(a.__value)):a.checked=Ke(a.__value,c)}),Oe(()=>{var c=r.indexOf(a);c!==-1&&r.splice(c,1)}),Se.has(r)||(Se.add(r),oe(()=>{r.sort((c,l)=>c.compareDocumentPosition(l)===4?-1:1),Se.delete(r)})),oe(()=>{if(o){var c;if(i)c=We(r,c,a.checked);else{var l=r.find(v=>v.checked);c=l?.__value}n(c)}})}function Fa(e,t,a=t){pe(e,"change",s=>{var n=s?e.defaultChecked:e.checked;a(n)}),(S&&e.defaultChecked!==e.checked||ce(t)==null)&&a(e.checked),Ce(()=>{var s=t();e.checked=!!s})}function We(e,t,a){for(var s=new Set,n=0;n<e.length;n+=1)e[n].checked&&s.add(e[n].__value);return a||s.delete(t),Array.from(s)}function $e(e){var t=e.type;return t==="number"||t==="range"}function we(e){return e===""?null:+e}const ka={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Na=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0;return!1};const Ve=(...e)=>e.filter((t,a,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===a).join(" ").trim();var Ea=Kt("<svg><!><!></svg>");function ae(e,t){const a=D(t,["children","$$slots","$$events","$$legacy"]),s=D(a,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Ut(t,!1);let n=z(t,"name",8,void 0),i=z(t,"color",8,"currentColor"),r=z(t,"size",8,24),o=z(t,"strokeWidth",8,2),f=z(t,"absoluteStrokeWidth",8,!1),c=z(t,"iconNode",24,()=>[]);sa();var l=Ea();He(l,(m,$,T)=>({...ka,...m,...s,width:r(),height:r(),stroke:i(),"stroke-width":$,class:T}),[()=>Na(s)?void 0:{"aria-hidden":"true"},()=>(H(f()),H(o()),H(r()),ce(()=>f()?Number(o())*24/Number(r()):o())),()=>(H(Ve),H(n()),H(a),ce(()=>Ve("lucide-icon","lucide",n()?`lucide-${n()}`:"",a.class)))]);var v=Qt(l);oa(v,1,c,ra,(m,$)=>{var T=ea(()=>ta(V($),2));let d=()=>V(T)[0],p=()=>V(T)[1];var N=F(),E=B(N);fa(E,d,!0,(b,O)=>{He(b,()=>({...p()}))}),x(m,N)});var u=Xt(v);G(u,t,"default",{}),Zt(l),x(e,l),Yt()}function Ba(e,t){const a=D(t,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 2v4"}],["path",{d:"m16.2 7.8 2.9-2.9"}],["path",{d:"M18 12h4"}],["path",{d:"m16.2 16.2 2.9 2.9"}],["path",{d:"M12 18v4"}],["path",{d:"m4.9 19.1 2.9-2.9"}],["path",{d:"M2 12h4"}],["path",{d:"m4.9 4.9 2.9 2.9"}]];ae(e,te({name:"loader"},()=>a,{get iconNode(){return s},children:(n,i)=>{var r=F(),o=B(r);G(o,t,"default",{}),x(n,r)},$$slots:{default:!0}}))}function Ga(e,t){const a=D(t,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]];ae(e,te({name:"plus"},()=>a,{get iconNode(){return s},children:(n,i)=>{var r=F(),o=B(r);G(o,t,"default",{}),x(n,r)},$$slots:{default:!0}}))}class Oa{ws=null;listeners=new Map;url;reconnectAttempts=0;maxReconnectAttempts=5;reconnectTimer=null;_intentionalClose=!1;constructor(t){const a=window.location.protocol==="https:"?"wss:":"ws:";this.url=`${a}//${window.location.host}${t}`}connect(){this._intentionalClose=!1,this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this.reconnectAttempts=0,this.notify("_open",{type:"_open",timestamp:""})},this.ws.onmessage=t=>{try{const a=JSON.parse(t.data);this.notify(a.type,a),this.notify("*",a)}catch{console.warn("[StudioWebSocket] Unparseable frame:",t.data)}},this.ws.onclose=()=>{this.notify("_close",{type:"_close",timestamp:""}),this._intentionalClose||this.attemptReconnect()},this.ws.onerror=()=>{this.notify("_error",{type:"_error",timestamp:""})}}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){this.notify("_reconnect_failed",{type:"_reconnect_failed",timestamp:""});return}this.reconnectAttempts++;const t=Math.min(1e3*Math.pow(2,this.reconnectAttempts-1),1e4);this.reconnectTimer=setTimeout(()=>{this.connect()},t)}notify(t,a){const s=this.listeners.get(t);if(s)for(const n of s)try{n(a)}catch(i){console.error(`[StudioWebSocket] Listener error for '${t}':`,i)}}on(t,a){return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(a),()=>this.listeners.get(t)?.delete(a)}send(t){this.ws?.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.warn("[StudioWebSocket] Cannot send: WebSocket not open")}get connected(){return this.ws?.readyState===WebSocket.OPEN}disconnect(){this._intentionalClose=!0,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws?.close(),this.ws=null}}const P=I([]),ue=I([]);function qa(){const e=J(P),t=J(ue);return{nodes:e.map(a=>({id:a.id,type:a.type??"pipeline_step",label:a.data?.label??a.id,position:a.position,data:a.data??{},width:a.measured?.width??a.width??null,height:a.measured?.height??a.height??null})),edges:t.map(a=>({id:a.id,source:a.source,target:a.target,source_handle:a.sourceHandle??"output",target_handle:a.targetHandle??"input",label:a.label??null})),metadata:{}}}const st=I(null),Ua=aa([P,st],([e,t])=>t?e.find(a=>a.id===t)??null:null),nt=I(new Map);function Ya(e,t){nt.update(a=>{const s=new Map(a);return s.set(e,t),s}),Pa(e,"_executionState",t)}function Ka(){nt.update(e=>{const t=new Map;for(const[a]of e)t.set(a,"idle");return t}),P.update(e=>e.map(t=>({...t,data:{...t.data,_executionState:"idle"}})))}let re=0;function Ae(){const e=J(P);let t=0;for(const a of e){const s=a.id.match(/-(\d+)$/);if(s){const n=parseInt(s[1],10);n>t&&(t=n)}}re=t}function Qa(e,t){re++;const a=`${e}-${re}`,s=J(P),n=J(st);let i=250,r=200;const o=280,f=0;if(n){const l=s.find(v=>v.id===n);l&&(i=l.position.x+o,r=l.position.y+f)}else if(s.length>0){let l=-1/0,v=200;for(const u of s)u.position.x>l&&(l=u.position.x,v=u.position.y);i=l+o,r=v}s.some(l=>Math.abs(l.position.x-i)<20&&Math.abs(l.position.y-r)<20)&&(r+=120),P.update(l=>[...l,{id:a,type:e,position:{x:i,y:r},data:{label:`${t} ${re}`}}])}function Pa(e,t,a){P.update(s=>s.map(n=>n.id===e?{...n,data:{...n.data,[t]:a}}:n))}const rt="/api";async function h(e,t){const a=await fetch(`${rt}${e}`,{headers:{"Content-Type":"application/json"},...t});if(!a.ok){const s=await a.json().catch(()=>({detail:a.statusText}));throw new Error(s.detail||a.statusText)}return a.json()}const q={health:()=>h("/health"),registry:{agents:()=>h("/registry/agents"),tools:()=>h("/registry/tools"),patterns:()=>h("/registry/patterns")},projects:{list:()=>h("/projects"),create:(e,t)=>h("/projects",{method:"POST",body:JSON.stringify({name:e,description:t})}),delete:e=>h(`/projects/${e}`,{method:"DELETE"}),savePipeline:(e,t,a)=>h(`/projects/${e}/pipelines/${t}`,{method:"POST",body:JSON.stringify({graph:a})}),loadPipeline:(e,t)=>h(`/projects/${e}/pipelines/${t}`),getHistory:e=>h(`/projects/${e}/history`),restoreVersion:(e,t)=>h(`/projects/${e}/restore`,{method:"POST",body:JSON.stringify({commit_sha:t})}),bookmarkVersion:(e,t,a)=>h(`/projects/${e}/bookmark`,{method:"POST",body:JSON.stringify({commit_sha:t,label:a})})},files:{list:e=>h(`/projects/${e}/files`),read:(e,t)=>h(`/projects/${e}/files/${t}`)},evaluate:{uploadDataset:(e,t)=>{const a=new FormData;return a.append("file",t),fetch(`${rt}/projects/${e}/datasets/upload`,{method:"POST",body:a}).then(async s=>{if(!s.ok){const n=await s.json().catch(()=>({detail:s.statusText}));throw new Error(n.detail||s.statusText)}return s.json()})},listDatasets:e=>h(`/projects/${e}/datasets`),run:(e,t,a)=>h("/evaluate/run",{method:"POST",body:JSON.stringify({project:e,dataset:t,graph:a})})},experiments:{list:e=>h(`/projects/${e}/experiments`),create:(e,t,a)=>h(`/projects/${e}/experiments`,{method:"POST",body:JSON.stringify({name:t,variants:a})}),get:(e,t)=>h(`/projects/${e}/experiments/${t}`),delete:(e,t)=>h(`/projects/${e}/experiments/${t}`,{method:"DELETE"}),runVariant:(e,t,a,s,n)=>h(`/projects/${e}/experiments/${t}/run`,{method:"POST",body:JSON.stringify({variant_name:a,graph:s,input:n??""})})},codegen:{toCode:e=>h("/codegen/to-code",{method:"POST",body:JSON.stringify({graph:e})})},monitoring:{usage:()=>h("/monitoring/usage")},checkpoints:{list:()=>h("/checkpoints"),get:e=>h(`/checkpoints/${e}`),fork:(e,t)=>h("/checkpoints/fork",{method:"POST",body:JSON.stringify({from_index:e,modified_state:t})}),rewind:e=>h(`/checkpoints/${e}/rewind`,{method:"POST"}),diff:(e,t)=>h("/checkpoints/diff",{method:"POST",body:JSON.stringify({index_a:e,index_b:t})}),clear:()=>h("/checkpoints",{method:"DELETE"})},settings:{get:()=>h("/settings"),save:e=>h("/settings",{method:"POST",body:JSON.stringify(e)}),status:()=>h("/settings/status")},assistant:{getHistory:e=>h(`/assistant/${e}/history`),saveHistory:(e,t)=>h(`/assistant/${e}/history`,{method:"POST",body:JSON.stringify({messages:t})}),inferProjectName:e=>h("/assistant/infer-project-name",{method:"POST",body:JSON.stringify({message:e})})},oracle:{getInsights:e=>h(`/oracle/${e}/insights`),approveInsight:(e,t)=>h(`/oracle/${e}/insights/${t}/approve`,{method:"POST"}),skipInsight:(e,t)=>h(`/oracle/${e}/insights/${t}/skip`,{method:"POST"})},tunnel:{status:()=>h("/tunnel/status"),start:()=>h("/tunnel/start",{method:"POST"}),stop:()=>h("/tunnel/stop",{method:"POST"})},runtime:{start:e=>h(`/projects/${e}/runtime/start`,{method:"POST"}),stop:e=>h(`/projects/${e}/runtime/stop`,{method:"POST"}),status:e=>h(`/projects/${e}/runtime/status`),executions:e=>h(`/projects/${e}/runtime/executions`)},customTools:{list:()=>h("/custom-tools"),get:e=>h(`/custom-tools/${e}`),save:e=>h("/custom-tools",{method:"POST",body:JSON.stringify(e)}),delete:e=>h(`/custom-tools/${e}`,{method:"DELETE"}),register:e=>h(`/custom-tools/${e}/register`,{method:"POST"}),test:e=>h(`/custom-tools/${e}/test`,{method:"POST"}),catalog:()=>h("/custom-tools/catalog"),installConnector:(e,t)=>h(`/custom-tools/catalog/${e}/install`,{method:"POST",body:JSON.stringify(t??{})}),verifyConnector:e=>h(`/custom-tools/catalog/${e}/verify`,{method:"POST"})}},ve=I([]),ke=I(!1),he=I(!1);let A=null;function Ca(e){it(),A=new Oa(`/ws/oracle?project=${encodeURIComponent(e)}`),A.on("_open",()=>{ke.set(!0)}),A.on("_close",()=>{ke.set(!1)}),A.on("insight",t=>{const a=t;ve.update(s=>[a,...s])}),A.on("analysis_complete",()=>{he.set(!1)}),A.on("error",()=>{he.set(!1)}),A.on("canvas_synced",()=>{}),A.connect()}function it(){A&&(A.disconnect(),A=null),ke.set(!1),he.set(!1)}function Xa(e,t){A?.connected&&A.send({action:"sync_canvas",nodes:e,edges:t})}function Za(){A?.connected&&(he.set(!0),A.send({action:"analyze"}))}async function es(e,t){const a=await q.oracle.approveInsight(e,t);return ve.update(s=>s.map(n=>n.id===t?{...n,status:"approved"}:n)),a.action_instruction??null}async function ts(e,t){await q.oracle.skipInsight(e,t),ve.update(a=>a.map(s=>s.id===t?{...s,status:"skipped"}:s))}async function Ma(e){const t=await q.oracle.getInsights(e);ve.set(t)}const Ia=[{id:"blank",name:"Blank",description:"Start with an empty canvas",nodes:[],edges:[]},{id:"simple-qa",name:"Simple Q&A Agent",description:"A single agent with a tool — the simplest working pipeline",nodes:[{id:"agent-1",type:"agent",position:{x:200,y:200},data:{label:"Q&A Agent",model:"openai:gpt-4.1",instructions:"You are a helpful assistant. Answer the user's questions clearly and concisely.",description:"Main Q&A agent"}},{id:"tool-1",type:"tool",position:{x:500,y:200},data:{label:"Web Search",description:"Search the web for relevant information"}}],edges:[{id:"edge-1",source:"agent-1",target:"tool-1",animated:!0}]},{id:"reasoning-pipeline",name:"Reasoning Pipeline",description:"Multi-step pipeline with reasoning, branching, and validation",nodes:[{id:"agent-1",type:"agent",position:{x:100,y:200},data:{label:"Input Agent",model:"openai:gpt-4.1",instructions:"Analyze the user input and prepare it for reasoning.",description:"Receives and preprocesses user input"}},{id:"reasoning-1",type:"reasoning",position:{x:350,y:200},data:{label:"Chain of Thought",pattern:"chain_of_thought",maxSteps:5}},{id:"condition-1",type:"condition",position:{x:600,y:200},data:{label:"Quality Check",condition:"result.confidence > 0.8"}},{id:"agent-2",type:"agent",position:{x:850,y:150},data:{label:"Output Agent",model:"openai:gpt-4.1-mini",instructions:"Format and present the final answer to the user.",description:"Formats final response"}},{id:"agent-3",type:"agent",position:{x:850,y:300},data:{label:"Retry Agent",model:"openai:gpt-4.1",instructions:"The previous reasoning was not confident enough. Try again with more detail.",description:"Retries with more detail"}}],edges:[{id:"edge-1",source:"agent-1",target:"reasoning-1",animated:!0},{id:"edge-2",source:"reasoning-1",target:"condition-1",animated:!0},{id:"edge-3",source:"condition-1",target:"agent-2",animated:!0},{id:"edge-4",source:"condition-1",target:"agent-3",animated:!0}]}],ot="fireflyStudio:selectedProject",ja=I(null),Ne=I([]);async function lt(e){ja.set(e);try{localStorage.setItem(ot,e.name)}catch{}try{const t=await q.projects.loadPipeline(e.name,"main");if(t&&typeof t=="object"){const a=t;a.nodes&&P.set(a.nodes),a.edges&&ue.set(a.edges),Ae()}}catch{P.set([]),ue.set([]),Ae()}it(),Ca(e.name),Ma(e.name).catch(()=>{})}async function as(e){const t=await q.projects.create(e);await La();const s=J(Ne).find(n=>n.name===e);return s&&lt(s),t}async function La(){try{let e=await q.projects.list();if(e.length===0){Ne.set([]);return}Ne.set(e);let t;try{const a=localStorage.getItem(ot);a&&(t=e.find(s=>s.name===a))}catch{}lt(t??e[0])}catch(e){console.warn("[studio] Failed to initialise projects:",e)}}function ss(e,t){const a=Ia.find(n=>n.id===e);if(!a)return;const s=a.nodes;P.set(s),ue.set(a.edges),Ae()}function ns(e,t){const a=D(t,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M10 22V7a1 1 0 0 0-1-1H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5a1 1 0 0 0-1-1H2"}],["rect",{x:"14",y:"2",width:"8",height:"8",rx:"1"}]];ae(e,te({name:"blocks"},()=>a,{get iconNode(){return s},children:(n,i)=>{var r=F(),o=B(r);G(o,t,"default",{}),x(n,r)},$$slots:{default:!0}}))}function rs(e,t){const a=D(t,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 18V5"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77"}]];ae(e,te({name:"brain"},()=>a,{get iconNode(){return s},children:(n,i)=>{var r=F(),o=B(r);G(o,t,"default",{}),x(n,r)},$$slots:{default:!0}}))}function is(e,t){const a=D(t,["children","$$slots","$$events","$$legacy"]);const s=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5"}],["path",{d:"M3 12A9 3 0 0 0 21 12"}]];ae(e,te({name:"database"},()=>a,{get iconNode(){return s},children:(n,i)=>{var r=F(),o=B(r);G(o,t,"default",{}),x(n,r)},$$slots:{default:!0}}))}export{Ae as A,rs as B,st as C,is as D,He as E,Y as F,K as G,ha as H,ae as I,za as J,Pa as K,Ba as L,Ua as M,Fa as N,Ja as O,Ga as P,ve as Q,ke as R,Oa as S,he as T,es as U,ts as V,ga as a,Va as b,q as c,as as d,oa as e,Ia as f,ns as g,lt as h,Ya as i,Ka as j,wa as k,ss as l,de as m,Wa as n,ma as o,Ne as p,ra as q,Za as r,G as s,ja as t,qa as u,P as v,La as w,Qa as x,Xa as y,ue as z};
