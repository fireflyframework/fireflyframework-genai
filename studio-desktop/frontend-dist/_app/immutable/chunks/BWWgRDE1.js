import{U as ne,b as Je,at as Be,h as S,c as q,au as Ge,a as ie,t as U,r as ft,Y as ut,s as je,d as W,e as V,av as ht,aw as pt,ax as Le,Q as C,ay as I,V as te,az as vt,X as gt,ah as _t,aA as qe,aB as Ee,aC as mt,aD as yt,a2 as bt,ac as xe,aE as St,R as Ue,T as Ye,aF as me,$ as oe,aG as $t,aH as wt,aI as kt,S as le,aJ as Tt,aK as At,E as Nt,aL as se,aM as Et,aN as Ot,aO as Pt,aP as Mt,aa as Ct,a5 as Oe,aQ as Ke,Z as Pe,aR as It,aS as Qe,aT as pe,aU as Xe,aV as jt,aW as Lt,aX as ae,aY as xt,K as Rt,G as zt,aZ as Ht,a_ as Dt,a$ as Vt,b0 as Wt,b1 as Ft,b2 as Jt,b3 as Bt,b4 as Gt,b5 as qt,b6 as Ut,as as Yt,m as ce,_ as Me,p as Kt,j,f as Qt,b7 as Xt,v as B,B as Zt,D as ea,C as ta,g as R,i as z,O as aa,b8 as sa,b9 as Ze,w as M,a4 as Y}from"./hL-aZVJ4.js";import"./DsnmJJEf.js";import{i as na}from"./D7CioVkw.js";import{B as ra,l as L,p as G,s as F}from"./B_6VzoXV.js";function ia(e,t){return t}function oa(e,t,a){for(var s=[],n=t.length,i,r=t.length,o=0;o<n;o++){let v=t[o];Ye(v,()=>{if(i){if(i.pending.delete(v),i.done.add(v),i.pending.size===0){var u=e.outrogroups;ke(Ee(i.done)),u.delete(i),u.size===0&&(e.outrogroups=null)}}else r-=1},!1)}if(r===0){var d=s.length===0&&a!==null;if(d){var c=a,l=c.parentNode;kt(l),l.append(c),e.items.clear()}ke(t,!d)}else i={pending:new Set(t),done:new Set},(e.outrogroups??=new Set).add(i)}function ke(e,t=!0){for(var a=0;a<e.length;a++)le(e[a],t)}var Re;function la(e,t,a,s,n,i=null){var r=e,o=new Map,d=(t&Be)!==0;if(d){var c=e;r=S?q(Ge(c)):c.appendChild(ne())}S&&ie();var l=null,v=_t(()=>{var p=a();return qe(p)?p:p==null?[]:Ee(p)}),u,_=!0;function $(){f.fallback=l,ca(f,u,r,t,s),l!==null&&(u.length===0?(l.f&I)===0?Ue(l):(l.f^=I,Z(l,null,r)):Ye(l,()=>{l=null}))}var k=Je(()=>{u=U(v);var p=u.length;let N=!1;if(S){var E=ft(r)===ut;E!==(p===0)&&(r=je(),q(r),W(!1),N=!0)}for(var b=new Set,O=C,m=gt(),g=0;g<p;g+=1){S&&V.nodeType===ht&&V.data===pt&&(r=V,N=!0,W(!1));var w=u[g],A=s(w,g),y=_?null:o.get(A);y?(y.v&&Le(y.v,w),y.i&&Le(y.i,g),m&&O.unskip_effect(y.e)):(y=da(o,_?r:Re??=ne(),w,A,g,n,t,a),_||(y.e.f|=I),o.set(A,y)),b.add(A)}if(p===0&&i&&!l&&(_?l=te(()=>i(r)):(l=te(()=>i(Re??=ne())),l.f|=I)),p>b.size&&vt(),S&&p>0&&q(je()),!_)if(m){for(const[ge,_e]of o)b.has(ge)||O.skip_effect(_e.e);O.oncommit($),O.ondiscard(()=>{})}else $();N&&W(!0),U(v)}),f={effect:k,items:o,outrogroups:null,fallback:l};_=!1,S&&(r=V)}function K(e){for(;e!==null&&(e.f&$t)===0;)e=e.next;return e}function ca(e,t,a,s,n){var i=(s&wt)!==0,r=t.length,o=e.items,d=K(e.effect.first),c,l=null,v,u=[],_=[],$,k,f,p;if(i)for(p=0;p<r;p+=1)$=t[p],k=n($,p),f=o.get(k).e,(f.f&I)===0&&(f.nodes?.a?.measure(),(v??=new Set).add(f));for(p=0;p<r;p+=1){if($=t[p],k=n($,p),f=o.get(k).e,e.outrogroups!==null)for(const y of e.outrogroups)y.pending.delete(f),y.done.delete(f);if((f.f&I)!==0)if(f.f^=I,f===d)Z(f,null,a);else{var N=l?l.next:d;f===e.effect.last&&(e.effect.last=f.prev),f.prev&&(f.prev.next=f.next),f.next&&(f.next.prev=f.prev),x(e,l,f),x(e,f,N),Z(f,N,a),l=f,u=[],_=[],d=K(l.next);continue}if((f.f&me)!==0&&(Ue(f),i&&(f.nodes?.a?.unfix(),(v??=new Set).delete(f))),f!==d){if(c!==void 0&&c.has(f)){if(u.length<_.length){var E=_[0],b;l=E.prev;var O=u[0],m=u[u.length-1];for(b=0;b<u.length;b+=1)Z(u[b],E,a);for(b=0;b<_.length;b+=1)c.delete(_[b]);x(e,O.prev,m.next),x(e,l,O),x(e,m,E),d=E,l=m,p-=1,u=[],_=[]}else c.delete(f),Z(f,d,a),x(e,f.prev,f.next),x(e,f,l===null?e.effect.first:l.next),x(e,l,f),l=f;continue}for(u=[],_=[];d!==null&&d!==f;)(c??=new Set).add(d),_.push(d),d=K(d.next);if(d===null)continue}(f.f&I)===0&&u.push(f),l=f,d=K(f.next)}if(e.outrogroups!==null){for(const y of e.outrogroups)y.pending.size===0&&(ke(Ee(y.done)),e.outrogroups?.delete(y));e.outrogroups.size===0&&(e.outrogroups=null)}if(d!==null||c!==void 0){var g=[];if(c!==void 0)for(f of c)(f.f&me)===0&&g.push(f);for(;d!==null;)(d.f&me)===0&&d!==e.fallback&&g.push(d),d=K(d.next);var w=g.length;if(w>0){var A=(s&Be)!==0&&r===0?a:null;if(i){for(p=0;p<w;p+=1)g[p].nodes?.a?.measure();for(p=0;p<w;p+=1)g[p].nodes?.a?.fix()}oa(e,g,A)}}i&&oe(()=>{if(v!==void 0)for(f of v)f.nodes?.a?.apply()})}function da(e,t,a,s,n,i,r,o){var d=(r&mt)!==0?(r&yt)===0?bt(a,!1,!1):xe(a):null,c=(r&St)!==0?xe(n):null;return{v:d,i:c,e:te(()=>(i(t,d??a,c??n,o),()=>{e.delete(s)}))}}function Z(e,t,a){if(e.nodes)for(var s=e.nodes.start,n=e.nodes.end,i=t&&(t.f&I)===0?t.nodes.start:a;s!==null;){var r=Tt(s);if(i.before(s),s===n)return;s=r}}function x(e,t,a){t===null?e.effect.first=a:t.next=a,a===null?e.effect.last=t:a.prev=t}function H(e,t,a,s,n){S&&ie();var i=t.$$slots?.[a],r=!1;i===!0&&(i=t.children,r=!0),i===void 0||i(e,r?()=>s:s)}function fa(e,t,a,s,n,i){let r=S;S&&ie();var o=null;S&&V.nodeType===At&&(o=V,ie());var d=S?V:e,c=new ra(d,!1);Je(()=>{const l=t()||null;var v=Ot;if(l===null){c.ensure(null,null),se(!0);return}return c.ensure(l,u=>{if(l){if(o=S?o:Et(l,v),Pt(o,o),s){S&&Mt(l)&&o.append(document.createComment(""));var _=S?Ge(o):o.appendChild(ne());S&&(_===null?W(!1):q(_)),s(o,_)}Ct.nodes.end=o,u.before(o)}S&&q(u)}),se(!0),()=>{l&&se(!1)}},Nt),Oe(()=>{se(!0)}),r&&(W(!0),q(d))}function ua(e,t){var a=void 0,s;Ke(()=>{a!==(a=t())&&(s&&(le(s),s=null),a&&(s=te(()=>{Pe(()=>a(e))})))})}function et(e){var t,a,s="";if(typeof e=="string"||typeof e=="number")s+=e;else if(typeof e=="object")if(Array.isArray(e)){var n=e.length;for(t=0;t<n;t++)e[t]&&(a=et(e[t]))&&(s&&(s+=" "),s+=a)}else for(a in e)e[a]&&(s&&(s+=" "),s+=a);return s}function ha(){for(var e,t,a=0,s="",n=arguments.length;a<n;a++)(e=arguments[a])&&(t=et(e))&&(s&&(s+=" "),s+=t);return s}function pa(e){return typeof e=="object"?ha(e):e??""}const ze=[...` 	
\r\f \v\uFEFF`];function va(e,t,a){var s=e==null?"":""+e;if(t&&(s=s?s+" "+t:t),a){for(var n of Object.keys(a))if(a[n])s=s?s+" "+n:n;else if(s.length)for(var i=n.length,r=0;(r=s.indexOf(n,r))>=0;){var o=r+i;(r===0||ze.includes(s[r-1]))&&(o===s.length||ze.includes(s[o]))?s=(r===0?"":s.substring(0,r))+s.substring(o+1):r=o}}return s===""?null:s}function He(e,t=!1){var a=t?" !important;":";",s="";for(var n of Object.keys(e)){var i=e[n];i!=null&&i!==""&&(s+=" "+n+": "+i+a)}return s}function ye(e){return e[0]!=="-"||e[1]!=="-"?e.toLowerCase():e}function ga(e,t){if(t){var a="",s,n;if(Array.isArray(t)?(s=t[0],n=t[1]):s=t,e){e=String(e).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var i=!1,r=0,o=!1,d=[];s&&d.push(...Object.keys(s).map(ye)),n&&d.push(...Object.keys(n).map(ye));var c=0,l=-1;const k=e.length;for(var v=0;v<k;v++){var u=e[v];if(o?u==="/"&&e[v-1]==="*"&&(o=!1):i?i===u&&(i=!1):u==="/"&&e[v+1]==="*"?o=!0:u==='"'||u==="'"?i=u:u==="("?r++:u===")"&&r--,!o&&i===!1&&r===0){if(u===":"&&l===-1)l=v;else if(u===";"||v===k-1){if(l!==-1){var _=ye(e.substring(c,l).trim());if(!d.includes(_)){u!==";"&&v++;var $=e.substring(c,v).trim();a+=" "+$+";"}}c=v+1,l=-1}}}}return s&&(a+=He(s)),n&&(a+=He(n,!0)),a=a.trim(),a===""?null:a}return e==null?null:String(e)}function _a(e,t,a,s,n,i){var r=e.__className;if(S||r!==a||r===void 0){var o=va(a,s,i);(!S||o!==e.getAttribute("class"))&&(o==null?e.removeAttribute("class"):t?e.className=o:e.setAttribute("class",o)),e.__className=a}else if(i&&n!==i)for(var d in i){var c=!!i[d];(n==null||c!==!!n[d])&&e.classList.toggle(d,c)}return i}function be(e,t={},a,s){for(var n in a){var i=a[n];t[n]!==i&&(a[n]==null?e.style.removeProperty(n):e.style.setProperty(n,i,s))}}function ma(e,t,a,s){var n=e.__style;if(S||n!==t){var i=ga(t,s);(!S||i!==e.getAttribute("style"))&&(i==null?e.removeAttribute("style"):e.style.cssText=i),e.__style=t}else s&&(Array.isArray(s)?(be(e,a?.[0],s[0]),be(e,a?.[1],s[1],"important")):be(e,a,s));return s}function de(e,t,a=!1){if(e.multiple){if(t==null)return;if(!qe(t))return It();for(var s of e.options)s.selected=t.includes(ee(s));return}for(s of e.options){var n=ee(s);if(Qe(n,t)){s.selected=!0;return}}(!a||t!==void 0)&&(e.selectedIndex=-1)}function tt(e){var t=new MutationObserver(()=>{de(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Oe(()=>{t.disconnect()})}function Va(e,t,a=t){var s=new WeakSet,n=!0;pe(e,"change",i=>{var r=i?"[selected]":":checked",o;if(e.multiple)o=[].map.call(e.querySelectorAll(r),ee);else{var d=e.querySelector(r)??e.querySelector("option:not([disabled])");o=d&&ee(d)}a(o),C!==null&&s.add(C)}),Pe(()=>{var i=t();if(e===document.activeElement){var r=Xe??C;if(s.has(r))return}if(de(e,i,n),n&&i===void 0){var o=e.querySelector(":checked");o!==null&&(i=ee(o),a(i))}e.__value=i,n=!1}),tt(e)}function ee(e){return"__value"in e?e.__value:e.value}const Q=Symbol("class"),X=Symbol("style"),at=Symbol("is custom element"),st=Symbol("is html"),ya=ae?"link":"LINK",ba=ae?"input":"INPUT",Sa=ae?"option":"OPTION",$a=ae?"select":"SELECT",wa=ae?"progress":"PROGRESS";function ka(e){if(S){var t=!1,a=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var s=e.value;fe(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var n=e.checked;fe(e,"checked",null),e.checked=n}}};e.__on_r=a,oe(a),Ft()}}function Wa(e,t){var a=Ce(e);a.value===(a.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!==wa)||(e.value=t??"")}function Ta(e,t){t?e.hasAttribute("selected")||e.setAttribute("selected",""):e.removeAttribute("selected")}function fe(e,t,a,s){var n=Ce(e);S&&(n[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName===ya)||n[t]!==(n[t]=a)&&(t==="loading"&&(e[Gt]=a),a==null?e.removeAttribute(t):typeof a!="string"&&nt(e).includes(t)?e[t]=a:e.setAttribute(t,a))}function Aa(e,t,a,s,n=!1,i=!1){if(S&&n&&e.nodeName===ba){var r=e,o=r.type==="checkbox"?"defaultChecked":"defaultValue";o in a||ka(r)}var d=Ce(e),c=d[at],l=!d[st];let v=S&&c;v&&W(!1);var u=t||{},_=e.nodeName===Sa;for(var $ in t)$ in a||(a[$]=null);a.class?a.class=pa(a.class):(s||a[Q])&&(a.class=null),a[X]&&(a.style??=null);var k=nt(e);for(const m in a){let g=a[m];if(_&&m==="value"&&g==null){e.value=e.__value="",u[m]=g;continue}if(m==="class"){var f=e.namespaceURI==="http://www.w3.org/1999/xhtml";_a(e,f,g,s,t?.[Q],a[Q]),u[m]=g,u[Q]=a[Q];continue}if(m==="style"){ma(e,g,t?.[X],a[X]),u[m]=g,u[X]=a[X];continue}var p=u[m];if(!(g===p&&!(g===void 0&&e.hasAttribute(m)))){u[m]=g;var N=m[0]+m[1];if(N!=="$$")if(N==="on"){const w={},A="$$"+m;let y=m.slice(2);var E=qt(y);if(xt(y)&&(y=y.slice(0,-7),w.capture=!0),!E&&p){if(g!=null)continue;e.removeEventListener(y,u[A],w),u[A]=null}if(E)Rt(y,e,g),zt([y]);else if(g!=null){let ge=function(_e){u[m].call(this,_e)};u[A]=Ht(y,e,ge,w)}}else if(m==="style")fe(e,m,g);else if(m==="autofocus")Dt(e,!!g);else if(!c&&(m==="__value"||m==="value"&&g!=null))e.value=e.__value=g;else if(m==="selected"&&_)Ta(e,g);else{var b=m;l||(b=Vt(b));var O=b==="defaultValue"||b==="defaultChecked";if(g==null&&!c&&!O)if(d[m]=null,b==="value"||b==="checked"){let w=e;const A=t===void 0;if(b==="value"){let y=w.defaultValue;w.removeAttribute(b),w.defaultValue=y,w.value=w.__value=A?y:null}else{let y=w.defaultChecked;w.removeAttribute(b),w.defaultChecked=y,w.checked=A?y:!1}}else e.removeAttribute(m);else O||k.includes(b)&&(c||typeof g!="string")?(e[b]=g,b in d&&(d[b]=Wt)):typeof g!="function"&&fe(e,b,g)}}}return v&&W(!0),u}function De(e,t,a=[],s=[],n=[],i,r=!1,o=!1){jt(n,a,s,d=>{var c=void 0,l={},v=e.nodeName===$a,u=!1;if(Ke(()=>{var $=t(...d.map(U)),k=Aa(e,c,$,i,r,o);u&&v&&"value"in $&&de(e,$.value);for(let p of Object.getOwnPropertySymbols(l))$[p]||le(l[p]);for(let p of Object.getOwnPropertySymbols($)){var f=$[p];p.description===Lt&&(!c||f!==c[p])&&(l[p]&&le(l[p]),l[p]=te(()=>ua(e,()=>f))),k[p]=f}c=k}),v){var _=e;Pe(()=>{de(_,c.value,!0),tt(_)})}u=!0})}function Ce(e){return e.__attributes??={[at]:e.nodeName.includes("-"),[st]:e.namespaceURI===Jt}}var Ve=new Map;function nt(e){var t=e.getAttribute("is")||e.nodeName,a=Ve.get(t);if(a)return a;Ve.set(t,a=[]);for(var s,n=e,i=Element.prototype;i!==n;){s=Ut(n);for(var r in s)s[r].set&&a.push(r);n=Bt(n)}return a}function Fa(e,t,a=t){var s=new WeakSet;pe(e,"input",async n=>{var i=n?e.defaultValue:e.value;if(i=$e(e)?we(i):i,a(i),C!==null&&s.add(C),await Yt(),i!==(i=t())){var r=e.selectionStart,o=e.selectionEnd,d=e.value.length;if(e.value=i??"",o!==null){var c=e.value.length;r===o&&o===d&&c>d?(e.selectionStart=c,e.selectionEnd=c):(e.selectionStart=r,e.selectionEnd=Math.min(o,c))}}}),(S&&e.defaultValue!==e.value||ce(t)==null&&e.value)&&(a($e(e)?we(e.value):e.value),C!==null&&s.add(C)),Me(()=>{var n=t();if(e===document.activeElement){var i=Xe??C;if(s.has(i))return}$e(e)&&n===we(e.value)||e.type==="date"&&!n&&!e.value||n!==e.value&&(e.value=n??"")})}const Se=new Set;function Ja(e,t,a,s,n=s){var i=a.getAttribute("type")==="checkbox",r=e;let o=!1;if(t!==null)for(var d of t)r=r[d]??=[];r.push(a),pe(a,"change",()=>{var c=a.__value;i&&(c=We(r,c,a.checked)),n(c)},()=>n(i?[]:null)),Me(()=>{var c=s();if(S&&a.defaultChecked!==a.checked){o=!0;return}i?(c=c||[],a.checked=c.includes(a.__value)):a.checked=Qe(a.__value,c)}),Oe(()=>{var c=r.indexOf(a);c!==-1&&r.splice(c,1)}),Se.has(r)||(Se.add(r),oe(()=>{r.sort((c,l)=>c.compareDocumentPosition(l)===4?-1:1),Se.delete(r)})),oe(()=>{if(o){var c;if(i)c=We(r,c,a.checked);else{var l=r.find(v=>v.checked);c=l?.__value}n(c)}})}function Ba(e,t,a=t){pe(e,"change",s=>{var n=s?e.defaultChecked:e.checked;a(n)}),(S&&e.defaultChecked!==e.checked||ce(t)==null)&&a(e.checked),Me(()=>{var s=t();e.checked=!!s})}function We(e,t,a){for(var s=new Set,n=0;n<e.length;n+=1)e[n].checked&&s.add(e[n].__value);return a||s.delete(t),Array.from(s)}function $e(e){var t=e.type;return t==="number"||t==="range"}function we(e){return e===""?null:+e}const Na={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};const Ea=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0;return!1};const Fe=(...e)=>e.filter((t,a,s)=>!!t&&t.trim()!==""&&s.indexOf(t)===a).join(" ").trim();var Oa=Xt("<svg><!><!></svg>");function J(e,t){const a=L(t,["children","$$slots","$$events","$$legacy"]),s=L(a,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);Kt(t,!1);let n=G(t,"name",8,void 0),i=G(t,"color",8,"currentColor"),r=G(t,"size",8,24),o=G(t,"strokeWidth",8,2),d=G(t,"absoluteStrokeWidth",8,!1),c=G(t,"iconNode",24,()=>[]);na();var l=Oa();De(l,(_,$,k)=>({...Na,..._,...s,width:r(),height:r(),stroke:i(),"stroke-width":$,class:k}),[()=>Ea(s)?void 0:{"aria-hidden":"true"},()=>(B(d()),B(o()),B(r()),ce(()=>d()?Number(o())*24/Number(r()):o())),()=>(B(Fe),B(n()),B(a),ce(()=>Fe("lucide-icon","lucide",n()?`lucide-${n()}`:"",a.class)))]);var v=Zt(l);la(v,1,c,ia,(_,$)=>{var k=aa(()=>sa(U($),2));let f=()=>U(k)[0],p=()=>U(k)[1];var N=R(),E=z(N);fa(E,f,!0,(b,O)=>{De(b,()=>({...p()}))}),j(_,N)});var u=ea(v);H(u,t,"default",{}),ta(l),j(e,l),Qt()}function Ga(e,t){const a=L(t,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 2v4"}],["path",{d:"m16.2 7.8 2.9-2.9"}],["path",{d:"M18 12h4"}],["path",{d:"m16.2 16.2 2.9 2.9"}],["path",{d:"M12 18v4"}],["path",{d:"m4.9 19.1 2.9-2.9"}],["path",{d:"M2 12h4"}],["path",{d:"m4.9 4.9 2.9 2.9"}]];J(e,F({name:"loader"},()=>a,{get iconNode(){return s},children:(n,i)=>{var r=R(),o=z(r);H(o,t,"default",{}),j(n,r)},$$slots:{default:!0}}))}function qa(e,t){const a=L(t,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]];J(e,F({name:"plus"},()=>a,{get iconNode(){return s},children:(n,i)=>{var r=R(),o=z(r);H(o,t,"default",{}),j(n,r)},$$slots:{default:!0}}))}class Pa{ws=null;listeners=new Map;url;reconnectAttempts=0;maxReconnectAttempts=5;reconnectTimer=null;_intentionalClose=!1;constructor(t){const a=window.location.protocol==="https:"?"wss:":"ws:";this.url=`${a}//${window.location.host}${t}`}connect(){this._intentionalClose=!1,this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this.reconnectAttempts=0,this.notify("_open",{type:"_open",timestamp:""})},this.ws.onmessage=t=>{try{const a=JSON.parse(t.data);this.notify(a.type,a),this.notify("*",a)}catch{console.warn("[StudioWebSocket] Unparseable frame:",t.data)}},this.ws.onclose=()=>{this.notify("_close",{type:"_close",timestamp:""}),this._intentionalClose||this.attemptReconnect()},this.ws.onerror=()=>{this.notify("_error",{type:"_error",timestamp:""})}}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){this.notify("_reconnect_failed",{type:"_reconnect_failed",timestamp:""});return}this.reconnectAttempts++;const t=Math.min(1e3*Math.pow(2,this.reconnectAttempts-1),1e4);this.reconnectTimer=setTimeout(()=>{this.connect()},t)}notify(t,a){const s=this.listeners.get(t);if(s)for(const n of s)try{n(a)}catch(i){console.error(`[StudioWebSocket] Listener error for '${t}':`,i)}}on(t,a){return this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(a),()=>this.listeners.get(t)?.delete(a)}send(t){this.ws?.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(t)):console.warn("[StudioWebSocket] Cannot send: WebSocket not open")}get connected(){return this.ws?.readyState===WebSocket.OPEN}disconnect(){this._intentionalClose=!0,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws?.close(),this.ws=null}}const P=M([]),ue=M([]);function Ua(){const e=Y(P),t=Y(ue);return{nodes:e.map(a=>({id:a.id,type:a.type??"pipeline_step",label:a.data?.label??a.id,position:a.position,data:a.data??{},width:a.measured?.width??a.width??null,height:a.measured?.height??a.height??null})),edges:t.map(a=>({id:a.id,source:a.source,target:a.target,source_handle:a.sourceHandle??"output",target_handle:a.targetHandle??"input",label:a.label??null})),metadata:{}}}const rt=M(null),Ya=Ze([P,rt],([e,t])=>t?e.find(a=>a.id===t)??null:null),it=M(new Map);function Ka(e,t){it.update(a=>{const s=new Map(a);return s.set(e,t),s}),Ma(e,"_executionState",t)}function Qa(){it.update(e=>{const t=new Map;for(const[a]of e)t.set(a,"idle");return t}),P.update(e=>e.map(t=>({...t,data:{...t.data,_executionState:"idle"}})))}let re=0;function Te(){const e=Y(P);let t=0;for(const a of e){const s=a.id.match(/-(\d+)$/);if(s){const n=parseInt(s[1],10);n>t&&(t=n)}}re=t}function Xa(e,t){re++;const a=`${e}-${re}`,s=Y(P),n=Y(rt);let i=250,r=200;const o=280,d=0;if(n){const l=s.find(v=>v.id===n);l&&(i=l.position.x+o,r=l.position.y+d)}else if(s.length>0){let l=-1/0,v=200;for(const u of s)u.position.x>l&&(l=u.position.x,v=u.position.y);i=l+o,r=v}s.some(l=>Math.abs(l.position.x-i)<20&&Math.abs(l.position.y-r)<20)&&(r+=120),P.update(l=>[...l,{id:a,type:e,position:{x:i,y:r},data:{label:`${t} ${re}`}}])}function Ma(e,t,a){P.update(s=>s.map(n=>n.id===e?{...n,data:{...n.data,[t]:a}}:n))}const ot="/api";async function h(e,t){const a=await fetch(`${ot}${e}`,{headers:{"Content-Type":"application/json"},...t});if(!a.ok){const s=await a.json().catch(()=>({detail:a.statusText}));throw new Error(s.detail||a.statusText)}return a.json()}const D={health:()=>h("/health"),registry:{agents:()=>h("/registry/agents"),tools:()=>h("/registry/tools"),patterns:()=>h("/registry/patterns")},projects:{list:()=>h("/projects"),create:(e,t)=>h("/projects",{method:"POST",body:JSON.stringify({name:e,description:t})}),delete:e=>h(`/projects/${e}`,{method:"DELETE"}),savePipeline:(e,t,a)=>h(`/projects/${e}/pipelines/${t}`,{method:"POST",body:JSON.stringify({graph:a})}),loadPipeline:(e,t)=>h(`/projects/${e}/pipelines/${t}`),getHistory:e=>h(`/projects/${e}/history`),restoreVersion:(e,t)=>h(`/projects/${e}/restore`,{method:"POST",body:JSON.stringify({commit_sha:t})}),bookmarkVersion:(e,t,a)=>h(`/projects/${e}/bookmark`,{method:"POST",body:JSON.stringify({commit_sha:t,label:a})})},files:{list:e=>h(`/projects/${e}/files`),read:(e,t)=>h(`/projects/${e}/files/${t}`)},evaluate:{uploadDataset:(e,t)=>{const a=new FormData;return a.append("file",t),fetch(`${ot}/projects/${e}/datasets/upload`,{method:"POST",body:a}).then(async s=>{if(!s.ok){const n=await s.json().catch(()=>({detail:s.statusText}));throw new Error(n.detail||s.statusText)}return s.json()})},listDatasets:e=>h(`/projects/${e}/datasets`),run:(e,t,a)=>h("/evaluate/run",{method:"POST",body:JSON.stringify({project:e,dataset:t,graph:a})})},experiments:{list:e=>h(`/projects/${e}/experiments`),create:(e,t,a)=>h(`/projects/${e}/experiments`,{method:"POST",body:JSON.stringify({name:t,variants:a})}),get:(e,t)=>h(`/projects/${e}/experiments/${t}`),delete:(e,t)=>h(`/projects/${e}/experiments/${t}`,{method:"DELETE"}),runVariant:(e,t,a,s,n)=>h(`/projects/${e}/experiments/${t}/run`,{method:"POST",body:JSON.stringify({variant_name:a,graph:s,input:n??""})})},codegen:{toCode:e=>h("/codegen/to-code",{method:"POST",body:JSON.stringify({graph:e})})},monitoring:{usage:()=>h("/monitoring/usage")},checkpoints:{list:()=>h("/checkpoints"),get:e=>h(`/checkpoints/${e}`),fork:(e,t)=>h("/checkpoints/fork",{method:"POST",body:JSON.stringify({from_index:e,modified_state:t})}),rewind:e=>h(`/checkpoints/${e}/rewind`,{method:"POST"}),diff:(e,t)=>h("/checkpoints/diff",{method:"POST",body:JSON.stringify({index_a:e,index_b:t})}),clear:()=>h("/checkpoints",{method:"DELETE"})},settings:{get:()=>h("/settings"),save:e=>h("/settings",{method:"POST",body:JSON.stringify(e)}),status:()=>h("/settings/status")},assistant:{getHistory:e=>h(`/assistant/${e}/history`),saveHistory:(e,t)=>h(`/assistant/${e}/history`,{method:"POST",body:JSON.stringify({messages:t})}),inferProjectName:e=>h("/assistant/infer-project-name",{method:"POST",body:JSON.stringify({message:e})})},oracle:{getInsights:e=>h(`/oracle/${e}/insights`),approveInsight:(e,t)=>h(`/oracle/${e}/insights/${t}/approve`,{method:"POST"}),skipInsight:(e,t)=>h(`/oracle/${e}/insights/${t}/skip`,{method:"POST"})},tunnel:{status:()=>h("/tunnel/status"),start:()=>h("/tunnel/start",{method:"POST"}),stop:()=>h("/tunnel/stop",{method:"POST"})},runtime:{start:e=>h(`/projects/${e}/runtime/start`,{method:"POST"}),stop:e=>h(`/projects/${e}/runtime/stop`,{method:"POST"}),status:e=>h(`/projects/${e}/runtime/status`),executions:e=>h(`/projects/${e}/runtime/executions`)},customTools:{list:()=>h("/custom-tools"),get:e=>h(`/custom-tools/${e}`),save:e=>h("/custom-tools",{method:"POST",body:JSON.stringify(e)}),delete:e=>h(`/custom-tools/${e}`,{method:"DELETE"}),register:e=>h(`/custom-tools/${e}/register`,{method:"POST"}),test:e=>h(`/custom-tools/${e}/test`,{method:"POST"}),catalog:()=>h("/custom-tools/catalog"),installConnector:(e,t)=>h(`/custom-tools/catalog/${e}/install`,{method:"POST",body:JSON.stringify(t??{})}),verifyConnector:e=>h(`/custom-tools/catalog/${e}/verify`,{method:"POST"})}},ve=M([]),Ae=M(!1),he=M(!1);let T=null;function Ca(e){lt(),T=new Pa(`/ws/oracle?project=${encodeURIComponent(e)}`),T.on("_open",()=>{Ae.set(!0)}),T.on("_close",()=>{Ae.set(!1)}),T.on("insight",t=>{const a=t;ve.update(s=>[a,...s])}),T.on("analysis_complete",()=>{he.set(!1)}),T.on("error",()=>{he.set(!1)}),T.on("canvas_synced",()=>{}),T.connect()}function lt(){T&&(T.disconnect(),T=null),Ae.set(!1),he.set(!1)}function Za(e,t){T?.connected&&T.send({action:"sync_canvas",nodes:e,edges:t})}function es(){T?.connected&&(he.set(!0),T.send({action:"analyze"}))}async function ts(e,t){const a=await D.oracle.approveInsight(e,t);return ve.update(s=>s.map(n=>n.id===t?{...n,status:"approved"}:n)),a.action_instruction??null}async function as(e,t){await D.oracle.skipInsight(e,t),ve.update(a=>a.map(s=>s.id===t?{...s,status:"skipped"}:s))}async function Ia(e){const t=await D.oracle.getInsights(e);ve.set(t)}const ja=[{id:"blank",name:"Blank",description:"Start with an empty canvas",nodes:[],edges:[]},{id:"simple-qa",name:"Simple Q&A Agent",description:"A single agent with a tool — the simplest working pipeline",nodes:[{id:"agent-1",type:"agent",position:{x:200,y:200},data:{label:"Q&A Agent",model:"openai:gpt-4.1",instructions:"You are a helpful assistant. Answer the user's questions clearly and concisely.",description:"Main Q&A agent"}},{id:"tool-1",type:"tool",position:{x:500,y:200},data:{label:"Web Search",description:"Search the web for relevant information"}}],edges:[{id:"edge-1",source:"agent-1",target:"tool-1",animated:!0}]},{id:"reasoning-pipeline",name:"Reasoning Pipeline",description:"Multi-step pipeline with reasoning, branching, and validation",nodes:[{id:"agent-1",type:"agent",position:{x:100,y:200},data:{label:"Input Agent",model:"openai:gpt-4.1",instructions:"Analyze the user input and prepare it for reasoning.",description:"Receives and preprocesses user input"}},{id:"reasoning-1",type:"reasoning",position:{x:350,y:200},data:{label:"Chain of Thought",pattern:"chain_of_thought",maxSteps:5}},{id:"condition-1",type:"condition",position:{x:600,y:200},data:{label:"Quality Check",condition:"result.confidence > 0.8"}},{id:"agent-2",type:"agent",position:{x:850,y:150},data:{label:"Output Agent",model:"openai:gpt-4.1-mini",instructions:"Format and present the final answer to the user.",description:"Formats final response"}},{id:"agent-3",type:"agent",position:{x:850,y:300},data:{label:"Retry Agent",model:"openai:gpt-4.1",instructions:"The previous reasoning was not confident enough. Try again with more detail.",description:"Retries with more detail"}}],edges:[{id:"edge-1",source:"agent-1",target:"reasoning-1",animated:!0},{id:"edge-2",source:"reasoning-1",target:"condition-1",animated:!0},{id:"edge-3",source:"condition-1",target:"agent-2",animated:!0},{id:"edge-4",source:"condition-1",target:"agent-3",animated:!0}]}],ct="fireflyStudio:selectedProject",La=M(null),Ne=M([]);async function dt(e){La.set(e);try{localStorage.setItem(ct,e.name)}catch{}try{const t=await D.projects.loadPipeline(e.name,"main");if(t&&typeof t=="object"){const a=t;a.nodes&&P.set(a.nodes),a.edges&&ue.set(a.edges),Te()}}catch{P.set([]),ue.set([]),Te()}lt(),Ca(e.name),Ia(e.name).catch(()=>{})}async function ss(e){const t=await D.projects.create(e);await xa();const s=Y(Ne).find(n=>n.name===e);return s&&dt(s),t}async function xa(){try{let e=await D.projects.list();if(e.length===0){Ne.set([]);return}Ne.set(e);let t;try{const a=localStorage.getItem(ct);a&&(t=e.find(s=>s.name===a))}catch{}dt(t??e[0])}catch(e){console.warn("[studio] Failed to initialise projects:",e)}}function ns(e,t){const a=ja.find(n=>n.id===e);if(!a)return;const s=a.nodes;P.set(s),ue.set(a.edges),Te()}function rs(e,t){const a=L(t,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M10 22V7a1 1 0 0 0-1-1H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5a1 1 0 0 0-1-1H2"}],["rect",{x:"14",y:"2",width:"8",height:"8",rx:"1"}]];J(e,F({name:"blocks"},()=>a,{get iconNode(){return s},children:(n,i)=>{var r=R(),o=z(r);H(o,t,"default",{}),j(n,r)},$$slots:{default:!0}}))}function is(e,t){const a=L(t,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M12 18V5"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77"}]];J(e,F({name:"brain"},()=>a,{get iconNode(){return s},children:(n,i)=>{var r=R(),o=z(r);H(o,t,"default",{}),j(n,r)},$$slots:{default:!0}}))}function os(e,t){const a=L(t,["children","$$slots","$$events","$$legacy"]);const s=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5"}],["path",{d:"M3 12A9 3 0 0 0 21 12"}]];J(e,F({name:"database"},()=>a,{get iconNode(){return s},children:(n,i)=>{var r=R(),o=z(r);H(o,t,"default",{}),j(n,r)},$$slots:{default:!0}}))}const Ie=M(null),ls=Ze(Ie,e=>{const t=new Set;if(!e)return t;const a=e.credentials;return a.openai_api_key&&t.add("openai"),a.anthropic_api_key&&t.add("anthropic"),a.google_api_key&&t.add("google"),a.groq_api_key&&t.add("groq"),a.mistral_api_key&&t.add("mistral"),a.deepseek_api_key&&t.add("deepseek"),a.cohere_api_key&&t.add("cohere"),a.azure_openai_api_key&&t.add("azure"),a.aws_access_key_id&&t.add("bedrock"),a.ollama_base_url&&t.add("ollama"),t});async function cs(){try{const e=await D.settings.get();Ie.set(e)}catch(e){console.warn("[studio] Failed to load settings:",e)}}async function ds(e,t,a,s){const n={};e!==void 0&&(n.credentials=e),t!==void 0&&(n.model_defaults=t),n.setup_complete=a,s!==void 0&&(n.user_profile=s);try{const i=await D.settings.save(n);Ie.set(i)}catch(i){throw console.error("[studio] Failed to save settings:",i),i}}function fs(e,t){const a=L(t,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M18 6 6 18"}],["path",{d:"m6 6 12 12"}]];J(e,F({name:"x"},()=>a,{get iconNode(){return s},children:(n,i)=>{var r=R(),o=z(r);H(o,t,"default",{}),j(n,r)},$$slots:{default:!0}}))}function us(e,t){const a=L(t,["children","$$slots","$$events","$$legacy"]);const s=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5"}],["path",{d:"M10 9H8"}],["path",{d:"M16 13H8"}],["path",{d:"M16 17H8"}]];J(e,F({name:"file-text"},()=>a,{get iconNode(){return s},children:(n,i)=>{var r=R(),o=z(r);H(o,t,"default",{}),j(n,r)},$$slots:{default:!0}}))}export{as as $,ds as A,is as B,cs as C,os as D,Za as E,us as F,ue as G,Te as H,J as I,rt as J,De as K,Ga as L,Q as M,X as N,pa as O,qa as P,Va as Q,Ma as R,Pa as S,Ya as T,Ba as U,Ja as V,ve as W,fs as X,Ae as Y,he as Z,ts as _,_a as a,Fa as b,D as c,ss as d,la as e,ja as f,Ie as g,rs as h,fe as i,dt as j,Ka as k,ns as l,Qa as m,ka as n,Wa as o,Ne as p,ma as q,es as r,H as s,ls as t,ia as u,La as v,Ua as w,P as x,xa as y,Xa as z};
